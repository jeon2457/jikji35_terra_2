<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="description" content="2026ì‚¬ìš©ë‚´ì—­ì„œ" />
  <link rel="icon" href="https://terraone-d0318.web.app/favicon.png" />
  
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    :root {
      --bg: #e0e5ec;
      --shadow: #a3b1c6;
      --light: #ffffff;
      --primary: #4A90E2;
    }

    body {
      background-color: var(--bg);
      font-family: 'Pretendard', sans-serif;
      margin: 0; padding: 20px;
      display: flex; flex-direction: column; align-items: center;
    }

    .container { width: 100%; max-width: 450px; }
    h2 { font-size: 28px; text-align: center; color: #444; margin-bottom: 20px; }

    /* ë‰´ëª¨í”¼ì¦˜ íƒ­ ìŠ¤íƒ€ì¼ */
    .tabs {
      display: flex; justify-content: space-around; margin-bottom: 20px;
      padding: 10px; border-radius: 20px;
      background: var(--bg);
      box-shadow: 8px 8px 15px var(--shadow), -8px -8px 15px var(--light);
    }
    .tab-btn {
      border: none; background: none; font-size: 18px; font-weight: bold;
      padding: 12px 20px; color: #666; cursor: pointer; border-radius: 12px;
    }
    .tab-btn.active {
      box-shadow: inset 6px 6px 10px var(--shadow), inset -6px -6px 10px var(--light);
      color: var(--primary);
    }

    /* ì¹´ë“œ ì„¹ì…˜ */
    .card {
      background: var(--bg); padding: 25px; border-radius: 30px;
      box-shadow: 10px 10px 20px var(--shadow), -10px -10px 20px var(--light);
      margin-bottom: 20px;
    }

    label { display: block; margin: 12px 0 8px 10px; font-size: 18px; font-weight: bold; color: #555; }

    /* ì…ë ¥ì°½ ë° ì„ íƒì°½ */
    input, select {
      width: 100%; border: none; padding: 18px; font-size: 20px; border-radius: 15px;
      background: var(--bg); box-sizing: border-box;
      box-shadow: 5px 5px 10px var(--shadow), -5px -5px 10px var(--light);
      outline: none; color: #333; margin-bottom: 5px;
    }
    input:focus, select:focus {
      box-shadow: inset 5px 5px 10px var(--shadow), inset -5px -5px 10px var(--light);
    }

    .btn-main {
      width: 100%; padding: 20px; border: none; border-radius: 20px;
      font-size: 24px; font-weight: bold; color: white; 
      background: var(--primary);
      box-shadow: 6px 6px 15px var(--shadow), -6px -6px 15px var(--light);
      cursor: pointer; margin-top: 20px;
    }

    /* í†µê³„ í™”ë©´ìš© */
    .stats-card { display: none; text-align: center; }
    .date-selector { display: flex; gap: 10px; margin-bottom: 20px; justify-content: center; }
    .date-selector select { width: auto; padding: 10px 15px; font-size: 16px; }
    .stat-item { 
      margin-bottom: 15px; padding: 15px; border-radius: 15px; 
      box-shadow: 6px 6px 12px var(--shadow), -6px -6px 12px var(--light);
    }
    .stat-value { font-size: 28px; font-weight: bold; }
  </style>
</head>
<body>

<div class="container">
  <h2>ğŸ’ 2026ë…„ ì‚¬ìš©ë‚´ì—­ì„œ ğŸ’</h2>

  <div class="tabs">
    <button id="btn-input" class="tab-btn active" onclick="showTab('input')">ê¸°ë¡í•˜ê¸°</button>
    <button id="btn-stats" class="tab-btn" onclick="showTab('stats')">í†µê³„ë³´ê¸°</button>
  </div>

  <div id="input-tab" class="card">
    <label>ë‚ ì§œ</label>
    <input type="date" id="date">

    <label>ìœ í˜•</label>
    <select id="type" onchange="updateCategories()">
      <option value="ì§€ì¶œ">ğŸ’¸ ì§€ì¶œ</option>
      <option value="ì†Œë“">ğŸ’° ì†Œë“(ì›”íšŒë¹„)</option>
    </select>

    <label>í•­ëª©</label>
    <select id="category"></select>

    <label>ê²°ì œ ìˆ˜ë‹¨</label>
    <select id="asset">
      <option value="ì¹´ë“œ">ğŸ’³ ì¹´ë“œ</option>
      <option value="ì´ì²´">ğŸ¦ ì´ì²´</option>
      <option value="í˜„ê¸ˆ">ğŸ’µ í˜„ê¸ˆ</option>
    </select>

    <label>ë‚´ìš©</label>
    <input type="text" id="item" placeholder="ìƒì„¸ ë‚´ìš© ì…ë ¥">

    <label>ê¸ˆì•¡ (ì›)</label>
    <input type="text" id="amount" placeholder="0" inputmode="numeric" onkeyup="formatMoney(this)">

    <label>ì²¨ë¶€íŒŒì¼ (ì„ íƒ)</label>
    <input type="file" id="receipt" accept="image/*">

    <button class="btn-main" onclick="save()" id="saveBtn">ì €ì¥í•˜ê¸°</button>
  </div>

  <div id="stats-tab" class="card stats-card">
    <div class="date-selector">
      <select id="stat-year" onchange="loadStats()"></select>
      <select id="stat-month" onchange="loadStats()"></select>
    </div>

    <div id="chart_div" style="width: 100%; height: 250px;"></div>

    <div class="stat-item"><div style="color:#777;">ì„ íƒ ë‹¬ ì†Œë“</div><div id="m-income" class="stat-value" style="color:#2ecc71;">0ì›</div></div>
    <div class="stat-item"><div style="color:#777;">ì„ íƒ ë‹¬ ì§€ì¶œ</div><div id="m-expense" class="stat-value" style="color:#e74c3c;">0ì›</div></div>
    <div class="stat-item"><div style="color:#777;">í•´ë‹¹ ì›” ì”ì•¡</div><div id="m-total" class="stat-value">0ì›</div></div>
  </div>
</div>

<script>
  google.charts.load('current', {'packages':['corechart']});

  const categoryMap = {
    "ì§€ì¶œ": ["ì™¸ì‹/ë°°ë‹¬", "êµí†µ/ì°¨ëŸ‰", "ì£¼ê±°/í†µì‹ ", "ìƒí™œ/ë§ˆíŠ¸", "íŒ¨ì…˜/ë¯¸ìš©", "ê±´ê°•/ì˜ë£Œ", "êµìœ¡/ì—¬ê°€", "ê²½ì¡°ì‚¬/íšŒë¹„", "ìš©ëˆ/ê¸°íƒ€"],
    "ì†Œë“": ["ì›”íšŒë¹„", "ì°¬ì¡°ê¸ˆ", "ìš©ëˆ", "ê¸ˆìœµì†Œë“", "ê¸°íƒ€ì†Œë“"]
  };

  window.onload = function() {
    document.getElementById('date').value = new Date().toISOString().split('T')[0];
    updateCategories();
    initDateSelectors(); // í†µê³„ ë‚ ì§œ ë©”ë‰´ ìƒì„±
  };

  // ì—°ë„ì™€ ì›” ì„ íƒ ë©”ë‰´ ìƒì„± (ì‘ì€ ìˆ«ìë¶€í„° í° ìˆ«ì ìˆœì„œë¡œ)
  function initDateSelectors() {
    const yearSelect = document.getElementById('stat-year');
    const monthSelect = document.getElementById('stat-month');
    const now = new Date();
    const currentYear = now.getFullYear();
    
    // 2026ë…„ë¶€í„° ì‹œì‘í•˜ì—¬ 50ë…„ í›„ê¹Œì§€ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ìƒì„±
    // i++ ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ«ìê°€ ì ì  ì»¤ì§€ê²Œ ë§Œë“­ë‹ˆë‹¤.
    for (let i = 2026; i <= currentYear + 50; i++) {
      const opt = document.createElement('option');
      opt.value = i; 
      opt.innerText = i + "ë…„";
      
      // í˜„ì¬ ì—°ë„(ì˜¤ëŠ˜)ë¥¼ ê¸°ë³¸ ì„ íƒê°’ìœ¼ë¡œ ì§€ì •
      if (i === currentYear) opt.selected = true;
      yearSelect.appendChild(opt);
    }
    
    // 1ì›”~12ì›” ìƒì„±
    for (let i = 0; i < 12; i++) {
      const opt = document.createElement('option');
      opt.value = i; 
      opt.innerText = (i + 1) + "ì›”";
      if (i === now.getMonth()) opt.selected = true; 
      monthSelect.appendChild(opt);
    }
  }

  function updateCategories() {
    const type = document.getElementById('type').value;
    const cat = document.getElementById('category');
    cat.innerHTML = "";
    categoryMap[type].forEach(i => {
      const o = document.createElement('option'); o.value = i; o.innerText = i; cat.appendChild(o);
    });
  }

  function formatMoney(obj) {
    let v = obj.value.replace(/[^0-9]/g, "");
    obj.value = v.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }

  function showTab(name) {
    const isInput = name === 'input';
    document.getElementById('input-tab').style.display = isInput ? 'block' : 'none';
    document.getElementById('stats-tab').style.display = isInput ? 'none' : 'block';
    document.getElementById('btn-input').classList.toggle('active', isInput);
    document.getElementById('btn-stats').classList.toggle('active', !isInput);
    if(!isInput) loadStats();
  }

  function save() {
    const btn = document.getElementById('saveBtn');
    const fileInput = document.getElementById('receipt');
    const data = {
      date: document.getElementById('date').value,
      type: document.getElementById('type').value,
      category: document.getElementById('category').value,
      asset: document.getElementById('asset').value,
      item: document.getElementById('item').value,
      amount: document.getElementById('amount').value
    };

    if(!data.item || !data.amount) return alert('ë‚´ìš©ê³¼ ê¸ˆì•¡ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!');
    btn.disabled = true; btn.innerText = "ì €ì¥ ì¤‘...";

    if (fileInput.files.length > 0) {
      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        sendToServer(data, { data: e.target.result.split(',')[1], mimeType: file.type, fileName: file.name });
      };
      reader.readAsDataURL(file);
    } else {
      sendToServer(data, null);
    }
  }

  function sendToServer(data, fileData) {
    google.script.run.withSuccessHandler(() => {
      alert('âœ… ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!'); 
      document.getElementById('saveBtn').disabled = false;
      document.getElementById('saveBtn').innerText = "ì €ì¥í•˜ê¸°";
      document.getElementById('item').value = ""; 
      document.getElementById('amount').value = "";
      document.getElementById('receipt').value = "";
    }).addData(data, fileData);
  }

  function loadStats() {
    const year = document.getElementById('stat-year').value;
    const month = document.getElementById('stat-month').value;
    
    google.script.run.withSuccessHandler(res => {
      document.getElementById('m-income').innerText = res.income.toLocaleString() + "ì›";
      document.getElementById('m-expense').innerText = res.expense.toLocaleString() + "ì›";
      document.getElementById('m-total').innerText = (res.income - res.expense).toLocaleString() + "ì›";
      drawChart(res.chartData);
    }).getMonthlyStats(year, month); // ì„œë²„ì— ì„ íƒí•œ ë‚ ì§œ ì „ë‹¬
  }

  function drawChart(chartData) {
    if (!chartData || chartData.length === 0) {
      document.getElementById('chart_div').innerHTML = "<p style='padding-top:100px; color:#999;'>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
      return;
    }
    const data = google.visualization.arrayToDataTable([['Category', 'Amount'], ...chartData]);
    const options = {
      pieHole: 0.4,
      backgroundColor: 'transparent',
      chartArea: {width:'90%', height:'80%'},
      legend: {position: 'bottom'},
      colors: ['#e74c3c', '#f1c40f', '#e67e22', '#3498db', '#9b59b6', '#1abc9c']
    };
    new google.visualization.PieChart(document.getElementById('chart_div')).draw(data, options);
  }
</script>
</body>
</html>


<!-- 

ë‚˜ì˜ ì‚¬ìš©ë‚´ì—­ì„œ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì•„ì´ë””:  
https://docs.google.com/spreadsheets/d/1deOxChVeue7Vo7lQJF5oeG9fo83H6r9Q3GI-33IHgV4/edit?gid=0#gid=0
===>> 1deOxChVeue7Vo7lQJF5oeG9fo83H6r9Q3GI-33IHgV4

ë‚˜ì˜ êµ¬ê¸€ë“œë¼ì´ë¸Œ ì˜ìˆ˜ì¦ í´ë” ì•„ì´ë””:
https://drive.google.com/drive/folders/1M0PArcUowA-Jtw9CWytLBP36WvFJvmQJ 
===>> 1M0PArcUowA-Jtw9CWytLBP36WvFJvmQJ

ë‚˜ì˜ 2026ë…„ ì‚¬ìš©ë‚´ì—­ì„œ ë°°í¬ ID :  AKfycby0_rY97gQZrhMBM3XVjP1FIpRJohGMAwI73GOFySxjhR5AMB0wRSi9bm5vyjAYRIQ

ì›¹ì•± URL ì£¼ì†Œ:   https://script.google.com/macros/s/AKfycby0_rY97gQZrhMBM3XVjP1FIpRJohGMAwI73GOFySxjhR5AMB0wRSi9bm5vyjAYRIQ/exec

ìœ íŠœë¸Œ ì¶œì²˜: ê´‘ê³ ì—†ëŠ” í‰ìƒ ë¬´ë£Œ ì•± ë‚´ê°€ ì§ì ‘ ë§Œë“ ë‹¤! AIì´ˆë³´ìë„ OK! êµ¬ê¸€ì‹œíŠ¸ì™€ ì•±ìŠ¤ìŠ¤í¬ë¦½íŠ¸ë¡œ ìë™í™” ì•± ë§Œë“¤ê¸°

 https://youtu.be/_V6VZ0VGGCY?si=cogJA-l9rWNOGJ_w 
 
-->